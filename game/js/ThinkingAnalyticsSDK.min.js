"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}var Config={LIB_VERSION:"2.0.2",LIB_NAME:"MG"},_={},ArrayProto=Array.prototype,ObjProto=Object.prototype,slice=ArrayProto.slice,nativeToString=ObjProto.toString,nativeHasOwnProperty=Object.prototype.hasOwnProperty,nativeForEach=ArrayProto.forEach,nativeIsArray=Array.isArray,breaker={};_.each=function(e,t,n){if(null==e)return!1;if(nativeForEach&&e.forEach===nativeForEach)e.forEach(t,n);else if(e.length===+e.length){for(var i=0,r=e.length;i<r;i++)if(i in e&&t.call(n,e[i],i,e)===breaker)return!1}else for(var a in e)if(nativeHasOwnProperty.call(e,a)&&t.call(n,e[a],a,e)===breaker)return!1},_.extend=function(n){return _.each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(n[t]=e[t])}),n},_.extend2Layers=function(n){return _.each(slice.call(arguments,1),function(e){for(var t in e)void 0!==e[t]&&(_.isObject(e[t])&&_.isObject(n[t])?_.extend(n[t],e[t]):n[t]=e[t])}),n},_.isArray=nativeIsArray||function(e){return"[object Array]"===nativeToString.call(e)},_.isFunction=function(e){try{return"function"==typeof e}catch(e){return!1}},_.isPromise=function(e){return"[object Promise]"===nativeToString.call(e)&&null!==e},_.isObject=function(e){return"[object Object]"===nativeToString.call(e)&&null!==e},_.isEmptyObject=function(e){if(_.isObject(e)){for(var t in e)if(nativeHasOwnProperty.call(e,t))return!1;return!0}return!1},_.isUndefined=function(e){return void 0===e},_.isString=function(e){return"[object String]"===nativeToString.call(e)},_.isDate=function(e){return"[object Date]"===nativeToString.call(e)},_.isBoolean=function(e){return"[object Boolean]"===nativeToString.call(e)},_.isNumber=function(e){return"[object Number]"===nativeToString.call(e)&&/[\d\.]+/.test(String(e))},_.isJSONString=function(e){try{JSON.parse(e)}catch(e){return!1}return!0},_.decodeURIComponent=function(t){var n="";try{n=decodeURIComponent(t)}catch(e){n=t}return n},_.encodeDates=function(n){return _.each(n,function(e,t){_.isDate(e)?n[t]=_.formatDate(e):_.isObject(e)&&(n[t]=_.encodeDates(e))}),n},_.formatDate=function(e){function t(e){return e<10?"0"+e:e}return e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+" "+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+((n=e.getMilliseconds())<100&&9<n?"0"+n:n<10?"00"+n:n);var n},_.searchObjDate=function(n){try{(_.isObject(n)||_.isArray(n))&&_.each(n,function(e,t){_.isObject(e)||_.isArray(e)?_.searchObjDate(n[t]):_.isDate(e)&&(n[t]=_.formatDate(e))})}catch(e){logger$1.warn(e)}},_.UUID=function(){var e=(new Date).getTime();return String(Math.random()).replace(".","").slice(1,11)+"-"+e},_.UUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},_.setMpPlatform=function(e){_.mpPlatform=e},_.getMpPlatform=function(){return _.mpPlatform},_.createExtraHeaders=function(){return{"TA-Integration-Type":Config.LIB_NAME,"TA-Integration-Version":Config.LIB_VERSION,"TA-Integration-Count":"1","TA-Integration-Extra":_.getMpPlatform()}},_.checkAppId=function(e){return e=e.replace(/\s*/g,"")},_.checkUrl=function(e){return e=e.replace(/\s*/g,""),e=_.url("basic",e)},_.url=function(){function r(){return new RegExp(/(.*?)\.?([^\.]*?)\.(com|net|org|biz|ws|in|me|co\.uk|co|org\.uk|ltd\.uk|plc\.uk|me\.uk|edu|mil|br\.com|cn\.com|eu\.com|hu\.com|no\.com|qc\.com|sa\.com|se\.com|se\.net|us\.com|uy\.com|ac|co\.ac|gv\.ac|or\.ac|ac\.ac|af|am|as|at|ac\.at|co\.at|gv\.at|or\.at|asn\.au|com\.au|edu\.au|org\.au|net\.au|id\.au|be|ac\.be|adm\.br|adv\.br|am\.br|arq\.br|art\.br|bio\.br|cng\.br|cnt\.br|com\.br|ecn\.br|eng\.br|esp\.br|etc\.br|eti\.br|fm\.br|fot\.br|fst\.br|g12\.br|gov\.br|ind\.br|inf\.br|jor\.br|lel\.br|med\.br|mil\.br|net\.br|nom\.br|ntr\.br|odo\.br|org\.br|ppg\.br|pro\.br|psc\.br|psi\.br|rec\.br|slg\.br|tmp\.br|tur\.br|tv\.br|vet\.br|zlg\.br|br|ab\.ca|bc\.ca|mb\.ca|nb\.ca|nf\.ca|ns\.ca|nt\.ca|on\.ca|pe\.ca|qc\.ca|sk\.ca|yk\.ca|ca|cc|ac\.cn|net\.cn|com\.cn|edu\.cn|gov\.cn|org\.cn|bj\.cn|sh\.cn|tj\.cn|cq\.cn|he\.cn|nm\.cn|ln\.cn|jl\.cn|hl\.cn|js\.cn|zj\.cn|ah\.cn|gd\.cn|gx\.cn|hi\.cn|sc\.cn|gz\.cn|yn\.cn|xz\.cn|sn\.cn|gs\.cn|qh\.cn|nx\.cn|xj\.cn|tw\.cn|hk\.cn|mo\.cn|cn|cx|cz|de|dk|fo|com\.ec|tm\.fr|com\.fr|asso\.fr|presse\.fr|fr|gf|gs|co\.il|net\.il|ac\.il|k12\.il|gov\.il|muni\.il|ac\.in|co\.in|org\.in|ernet\.in|gov\.in|net\.in|res\.in|is|it|ac\.jp|co\.jp|go\.jp|or\.jp|ne\.jp|ac\.kr|co\.kr|go\.kr|ne\.kr|nm\.kr|or\.kr|li|lt|lu|asso\.mc|tm\.mc|com\.mm|org\.mm|net\.mm|edu\.mm|gov\.mm|ms|nl|no|nu|pl|ro|org\.ro|store\.ro|tm\.ro|firm\.ro|www\.ro|arts\.ro|rec\.ro|info\.ro|nom\.ro|nt\.ro|se|si|com\.sg|org\.sg|net\.sg|gov\.sg|sk|st|tf|ac\.th|co\.th|go\.th|mi\.th|net\.th|or\.th|tm|to|com\.tr|edu\.tr|gov\.tr|k12\.tr|net\.tr|org\.tr|com\.tw|org\.tw|net\.tw|ac\.uk|uk\.com|uk\.net|gb\.com|gb\.net|vg|sh|kz|ch|info|ua|gov|name|pro|ie|hk|com\.hk|org\.hk|net\.hk|edu\.hk|us|tk|cd|by|ad|lv|eu\.lv|bz|es|jp|cl|ag|mobi|eu|co\.nz|org\.nz|net\.nz|maori\.nz|iwi\.nz|io|la|md|sc|sg|vc|tw|travel|my|se|tv|pt|com\.pt|edu\.pt|asia|fi|com\.ve|net\.ve|fi|org\.ve|web\.ve|info\.ve|co\.ve|tel|im|gr|ru|net\.ru|org\.ru|hr|com\.hr|ly|xyz)$/)}function a(e,t){var n=e.charAt(0),t=t.split(n);return n===e?t:t[(e=parseInt(e.substring(1),10))<0?t.length+e:e-1]}function s(e,t){for(var n,i,r=e.charAt(0),a=t.split("&"),s=[],o={},c=e.substring(1),u=0,l=a.length;u<l;u++)if(""!==(s=(s=a[u].match(/(.*?)=(.*)/))||[a[u],a[u],""])[1].replace(/\s/g,"")){if(s[2]=(i=s[2]||"",_.decodeURIComponent(i.replace(/\+/g," "))),c===s[1])return s[2];(n=s[1].match(/(.*)\[([0-9]+)\]/))?(o[n[1]]=o[n[1]]||[],o[n[1]][n[2]]=s[2]):o[s[1]]=s[2]}return r===e?o:o[c]}return function(e,t){var n={};if("tld?"===e)return r();if(t=t||window.location.toString(),!e)return t;if(e=e.toString(),i=t.match(/^mailto:([^\/].+)/))n.protocol="mailto",n.email=i[1];else{if((i=t.match(/(.*?)\/#\!(.*)/))&&(t=i[1]+i[2]),(i=t.match(/(.*?)#(.*)/))&&(n.hash=i[2],t=i[1]),n.hash&&e.match(/^#/))return s(e,n.hash);if((i=t.match(/(.*?)\?(.*)/))&&(n.query=i[2],t=i[1]),n.query&&e.match(/^\?/))return s(e,n.query);if((i=t.match(/(.*?)\:?\/\/(.*)/))&&(n.protocol=i[1].toLowerCase(),t=i[2]),(i=t.match(/(.*?)(\/.*)/))&&(n.path=i[2],t=i[1]),n.path=(n.path||"").replace(/^([^\/])/,"/$1").replace(/\/$/,""),e.match(/^[\-0-9]+$/)&&(e=e.replace(/^([^\/])/,"/$1")),e.match(/^\//))return a(e,n.path.substring(1));if((i=(i=a("/-1",n.path.substring(1)))&&i.match(/(.*?)\.(.*)/))&&(n.file=i[0],n.filename=i[1],n.fileext=i[2]),(i=t.match(/(.*)\:([0-9]+)$/))&&(n.port=i[2],t=i[1]),(i=t.match(/(.*?)@(.*)/))&&(n.auth=i[1],t=i[2]),n.auth&&(i=n.auth.match(/(.*)\:(.*)/),n.user=i?i[1]:n.auth,n.pass=i?i[2]:void 0),n.hostname=t.toLowerCase(),"."===e.charAt(0))return a(e,n.hostname);r()&&(i=n.hostname.match(r()))&&(n.tld=i[3],n.domain=i[2]?i[2]+"."+i[3]:void 0,n.sub=i[1]||void 0);var i=n.port?":"+n.port:"";n.protocol=n.protocol||window.location.protocol.replace(":",""),n.port=n.port||("https"===n.protocol?"443":"80"),n.protocol=n.protocol||("443"===n.port?"https":"http"),n.basic=n.protocol+"://"+n.hostname+i}return e in n?n[e]:"{}"===e?n:""}}();var logger$1="object"===_typeof(logger$1)?logger$1:{};logger$1.info=function(){if("object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&logger$1.enabled)try{return console.log.apply(console,arguments)}catch(e){console.log(arguments[0])}},logger$1.warn=function(){if("object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&logger$1.enabled)try{return console.warn.apply(console,arguments)}catch(e){console.warn(arguments[0])}};var PlatformProxy=function(){function e(){_classCallCheck(this,e),this.config={persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_mg"}}return _createClass(e,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t){t&&logger.warn("TA: invalid storage configuration");e=localStorage.getItem(e);return _.isJSONString(e)?JSON.parse(e):{}}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"_setSystemProxy",value:function(e){this._sysCallback=e}},{key:"getSystemInfo",value:function(e){var t={mp_platform:"web",system:this._getOs(),screenWidth:window.screen.width,screenHeight:window.screen.height};this._sysCallback&&(t=_.extend(t,this._sysCallback(e))),e.success(t),e.complete()}},{key:"_getOs",value:function(){var e=navigator.userAgent;return/Windows/i.test(e)?/Phone/.test(e)||/WPDesktop/.test(e)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(e)?"iOS":/Android/.test(e)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(e)?"BlackBerry":/Mac/i.test(e)?"MacOS":/Linux/.test(e)?"Linux":/CrOS/.test(e)?"ChromeOS":""}},{key:"getNetworkType",value:function(e){e.complete()}},{key:"onNetworkStatusChange",value:function(){}},{key:"request",value:function(e){var t={},n=new XMLHttpRequest;if(n.open(e.method,e.url),e.header)for(var i in e.header)n.setRequestHeader(i,e.header[i]);return n.onreadystatechange=function(){4===n.readyState&&200===n.status?(t.statusCode=200,_.isJSONString(n.responseText)&&(t.data=JSON.parse(n.responseText)),e.success(t)):200!==n.status&&(t.errMsg="network error",e.fail(t))},n.ontimeout=function(){t.errMsg="timeout",e.fail(t)},n.send(e.data),n}},{key:"initAutoTrackInstance",value:function(){}},{key:"setGlobal",value:function(e,t){window[t]=e}},{key:"getAppOptions",value:function(){}},{key:"showToast",value:function(){}}],[{key:"createInstance",value:function(){return new e}}]),e}(),AutoTrackBridge=function(){function n(e,t){_classCallCheck(this,n),this.taInstance=e,this.config=t||{},this.referrer="直接打开",this.config.isPlugin?(e.App=function(){App.apply(this,arguments)},inension(e.Page)):(e=App,App=this._initAppExtention(e),e=Page,Page=this._initPageExtension(e))}return _createClass(n,[{key:"_initPageExtension",value:function(i){var r=this;return function(e){var t=e.onShow,n=e.onShareAppMessage;return e.onShow=function(e){r.onPageShow(),"function"==typeof t&&t.call(this,e)},"function"==typeof n&&(e.onShareAppMessage=function(e){e=n.call(this,e);return r.onPageShare(e)}),i(e)}}},{key:"_initAppExtention",value:function(r){var a=this;return function(e){var t=e.onLaunch,n=e.onShow,i=e.onHide;return e.onLaunch=function(e){a.onAppLaunch(e,this),"function"==typeof t&&t.call(this,e)},e.onShow=function(e){a.onAppShow(e),"function"==typeof n&&n.call(this,e)},e.onHide=function(){a.onAppHide(),"function"==typeof i&&i.call(this)},r(e)}}},{key:"onAppLaunch",value:function(e,t){this._setAutoTrackProperties(e),_.isUndefined(t)||(t[this.taInstance.name]=this.taInstance),this.config.appLaunch&&(t={},e&&e.path&&(t["#url_path"]=this._getPath(e.path)),this.taInstance._internalTrack("ta_mp_launch",t))}},{key:"onAppShow",value:function(e){var t;this.config.appHide&&this.taInstance.timeEvent("ta_mp_hide"),this._setAutoTrackProperties(e),this.config.appShow&&(t={},e&&e.path&&(t["#url_path"]=this._getPath(e.path)),this.taInstance._internalTrack("ta_mp_show",t))}},{key:"onAppHide",value:function(){var e;this.config.appHide&&(e={"#url_path":this._getCurrentPath()},this.taInstance._internalTrack("ta_mp_hide",e))}},{key:"_getCurrentPath",value:function(){var e="未取到";try{var t=getCurrentPages(),e=t[t.length-1].route}catch(e){logger$1.info(e)}return e}},{key:"_setAutoTrackProperties",value:function(e){e={"#scene":e.scene};this.taInstance._setAutoTrackProperties(e)}},{key:"_getPath",value:function(e){return"string"==typeof e?e.replace(/^\//,""):"取值异常"}},{key:"onPageShare",value:function(e){return this.config.pageShare&&this.taInstance._internalTrack("ta_mp_share",{"#url_path":this._getCurrentPath()}),_.isObject(e)?e:{}}},{key:"onPageShow",value:function(){var e,t;this.config.pageShow&&(t={"#url_path":(e=this._getCurrentPath())||"系统没有取到值","#referrer":this.referrer},this.referrer=e,this.taInstance._internalTrack("ta_mp_view",t))}}]),n}(),AutoTrackBridge$1=function(){function r(e,t,n){var i=this;_classCallCheck(this,r),this.taInstance=e,this.config=t||{};t=n.getLaunchOptionsSync();this._onShow(t),this.startTracked=!0,n.onShow(function(e){i._onShow(e)}),n.onHide(function(){i.startTracked=!1,i.config.appHide&&i.taInstance._internalTrack("ta_mg_hide")})}return _createClass(r,[{key:"_onShow",value:function(e){this.startTracked||(this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),e&&e.scene&&this.taInstance._setAutoTrackProperties({"#scene":e.scene}),this.config.appShow&&this.taInstance._internalTrack("ta_mg_show"))}}]),r}(),PlatformProxy$1=function(){function i(e,t,n){_classCallCheck(this,i),this.api=e,this.config=t,this._config=n}return _createClass(i,[{key:"getConfig",value:function(){return this.config}},{key:"getStorage",value:function(e,t,n){if(!t){if("dd_mp"===this._config.platform){var i=this.api.getStorageSync({key:e});return _.isJSONString(i.data)?JSON.parse(i.data):{}}i=this.api.getStorageSync(e);return _.isJSONString(i)?JSON.parse(i):{}}this.api.getStorage({key:e,success:function(e){e=_.isJSONString(e.data)?JSON.parse(e.data):{};n(e)},fail:function(){logger$1.warn("getStorage faild"),n({})}})}},{key:"setStorage",value:function(e,t){this.api.setStorage({key:e,data:t})}},{key:"_getPlatform",value:function(){return""}},{key:"getSystemInfo",value:function(t){var n=this._config.mpPlatform;this.api.getSystemInfo({success:function(e){_.isFunction(n)?e.mp_platform=n(e):e.mp_platform=n,t.success(e)},complete:function(){t.complete()}})}},{key:"getNetworkType",value:function(t){this.api.getNetworkType({success:function(e){t.success(e)},complete:function(){t.complete()}})}},{key:"onNetworkStatusChange",value:function(e){this.api.onNetworkStatusChange(e)}},{key:"request",value:function(t){if("ali_mp"!==this._config.platform&&"dd_mp"!==this._config.platform)return this.api.request(t);var e=_.extend({},t);return e.headers=t.header,e.success=function(e){e.statusCode=e.status,t.success(e)},e.fail=function(e){e.errMsg=e.errorMessage,t.fail(e)},"dd_mp"===this._config.platform?this.api.httpRequest(e):this.api.request(e)}},{key:"initAutoTrackInstance",value:function(e,t){return _.isObject(t.autoTrack)&&(t.autoTrack.isPlugin=t.is_plugin),new(this._config.mp?AutoTrackBridge:AutoTrackBridge$1)(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){this._config.mp?logger$1.warn("ThinkingAnalytics: we do not set global name for TA instance when you do not enable auto track."):GameGlobal[t]=e}},{key:"getAppOptions",value:function(e){var t={};try{t=this.api.getLaunchOptionsSync()}catch(e){logger$1.warn("Cannot get launch options.")}if(_.isFunction(e))try{this._config.mp?this.api.onAppShow(e):this.api.onShow(e)}catch(e){logger$1.warn("Cannot register onShow callback.")}return t}},{key:"showToast",value:function(e){var t;_.isFunction(this.api.showToast)&&(t={title:e},"dd_mp"!==this._config.platform&&"ali_mp"!==this._config.platform||(t.content=e),this.api.showToast(t))}}],[{key:"createInstance",value:function(){return this._createInstance("R_CURRENT_PLATFORM")}},{key:"_createInstance",value:function(e){switch(e){case"wechat_mp":return new i(wx,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_wechat"},{mpPlatform:"wechat",mp:!0,platform:e});case"wechat_mg":return new i(wx,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_wechat_game"},{mpPlatform:"wechat",platform:e});case"qq_mg":return new i(qq,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qq_game"},{mpPlatform:"qq",platform:e});case"baidu_mp":return new i(swan,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_swan"},{mpPlatform:function(e){return e.host},mp:!0,platform:e});case"baidu_mg":return new i(swan,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_swan_game"},{mpPlatform:function(e){return e.host},platform:e});case"tt_mg":return new i(tt,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_tt_game"},{mpPlatform:function(e){return e.appName},platform:e});case"tt_mp":return new i(tt,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_tt"},{mpPlatform:function(e){return e.appName},mp:!0,platform:e});case"ali_mp":return new i(my,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_ali"},{mpPlatform:function(e){return e.app},mp:!0,platform:e});case"dd_mp":return new i(dd,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_dd"},{mpPlatform:"dingding",mp:!0,platform:e});case"bl_mg":return new i(bl,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_mg"},{mpPlatform:"bilibili",platform:e});case"kuaishou_mp":return new i(ks,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_kuaishou"},{mpPlatform:"kuaishou",mp:!0,platform:e});case"WEB":return new PlatformProxy.createInstance}}}]),i}(),AutoTrackBridge$2=function e(t,n){var i=this;_classCallCheck(this,e),this.taInstance=t,this.config=n||{},this.config.appShow&&this.taInstance._internalTrack("ta_mg_show"),this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),qg.onShow(function(){i.config.appHide&&i.taInstance.timeEvent("ta_mg_hide"),i.config.appShow&&i.taInstance._internalTrack("ta_mg_show")}),qg.onHide(function(){i.config.appHide&&i.taInstance._internalTrack("ta_mg_hide")})},PlatformProxy$2=function(){function e(){_classCallCheck(this,e),this.config={persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_vivo_game",asyncPersistence:!0}}return _createClass(e,[{key:"getConfig",value:function(){return this.config||{}}},{key:"getStorage",value:function(e,t,n){t||logger$1.warn("TA: invalid storage configuration"),qg.getStorage({key:e,success:function(e){e=_.isJSONString(e)?JSON.parse(e):{};n(e)},fail:function(){n({})}})}},{key:"setStorage",value:function(e,t){qg.setStorage({key:e,value:t})}},{key:"getSystemInfo",value:function(i){qg.getSystemInfo({success:function(e){var t=e,n=[e.osType,e.osVersionName].join(" ");t.brand=e.manufacturer,t.system=n,t.mp_platform="vivo_qg",i.success(t)},complete:function(){i.complete()}})}},{key:"getNetworkType",value:function(n){qg.getNetworkType({success:function(e){var t=e;t.networkType=e.type,n.success(t)},complete:function(){n.complete()}})}},{key:"onNetworkStatusChange",value:function(n){qg.subscribeNetworkStatus({callback:function(e){var t=e;t.networkType=e.type,n(t)}})}},{key:"request",value:function(t){return qg.request({url:t.url,data:t.data,method:t.method,header:t.header,success:function(e){t.success(e)},fail:function(e){t.fail(e)}})}},{key:"initAutoTrackInstance",value:function(e,t){return new AutoTrackBridge$2(e,t.autoTrack)}},{key:"setGlobal",value:function(e,t){globalThis[t]=e}},{key:"getAppOptions",value:function(){return{}}},{key:"showToast",value:function(e){qg.showToast({message:e,duration:0})}}],[{key:"createInstance",value:function(){return new e}}]),e}(),AutoTrackBridge$3=function e(t,n,i){var r=this;_classCallCheck(this,e),this.taInstance=t,this.config=n||{},this.config.appShow&&this.taInstance._internalTrack("ta_mg_show"),this.config.appHide&&this.taInstance.timeEvent("ta_mg_hide"),i.onShow(function(){r.config.appHide&&r.taInstance.timeEvent("ta_mg_hide"),r.config.appShow&&r.taInstance._internalTrack("ta_mg_show")}),i.onHide(function(){r.config.appHide&&r.taInstance._internalTrack("ta_mg_hide")})},PlatformProxy$3=function(){function i(e,t,n){_classCallCheck(this,i),this.api=e,this.config=t,this._config=n}return _createClass(i,[{key:"getConfig",value:function(){return this.config||{}}},{key:"getStorage",value:function(e,t){t&&logger.warn("TA: invalid storage configuration");e=localStorage.getItem(e);return _.isJSONString(e)?JSON.parse(e):{}}},{key:"setStorage",value:function(e,t){localStorage.setItem(e,t)}},{key:"getSystemInfo",value:function(t){var n=this._config.mpPlatform;this.api.getSystemInfo({success:function(e){e.mp_platform=n,t.success(e)},complete:function(){t.complete()}})}},{key:"getNetworkType",value:function(t){this.api.getNetworkType({success:function(e){t.success(e)},complete:function(){t.complete()}})}},{key:"onNetworkStatusChange",value:function(t){this.api.onNetworkStatusChange({callback:function(e){t(e)}})}},{key:"request",value:function(e){var t={},n=new XMLHttpRequest;if(n.open(e.method,e.url),e.header)for(var i in e.header)n.setRequestHeader(i,e.header[i]);return n.onreadystatechange=function(){4===n.readyState&&200===n.status?(t.statusCode=200,_.isJSONString(n.responseText)&&(t.data=JSON.parse(n.responseText)),e.success(t)):200!==n.status&&(t.errMsg="network error",e.fail(t))},n.ontimeout=function(){t.errMsg="timeout",e.fail(t)},n.send(e.data),n}},{key:"initAutoTrackInstance",value:function(e,t){return new AutoTrackBridge$3(e,t.autoTrack,this.api)}},{key:"setGlobal",value:function(e,t){globalThis[t]=e}},{key:"getAppOptions",value:function(){return this.api.getLaunchOptionsSync()}},{key:"showToast",value:function(e){this.api.showToast({title:e,icon:"none",duration:2e3})}}],[{key:"createInstance",value:function(){return this._createInstance("R_CURRENT_PLATFORM")}},{key:"_createInstance",value:function(e){switch(e){case"oppo":return new i(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_oppo_game"},{mpPlatform:"oppo_qg"});case"huawei":return new i(hbs,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_huawei_game"},{mpPlatform:"huawei_qg"});case"mz":return new i(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg_mz_game"},{mpPlatform:"mz"});case"xiaomi":return new i(qg,{persistenceName:"thinkingdata",persistenceNameOld:"thinkingdata_qg"},{mpPlatform:"xiaomi"})}}}]),i}(),PlatformProxyEgret=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"createInstance",value:function(){if(egret.Capabilities.runtimeType===egret.RuntimeType.WXGAME)return PlatformProxy$1._createInstance("wechat_mg");if(egret.Capabilities.runtimeType===egret.RuntimeType.BAIDUGAME)return PlatformProxy$1._createInstance("baidu_mg");if(egret.Capabilities.runtimeType===egret.RuntimeType.QQGAME)return PlatformProxy$1._createInstance("qq_mg");if(egret.Capabilities.runtimeType===egret.RuntimeType.VIVOGAME)return PlatformProxy$2.createInstance();if(egret.Capabilities.runtimeType===egret.RuntimeType.OPPOGAME)return PlatformProxy$3._createInstance("oppo");if(egret.Capabilities.runtimeType===egret.RuntimeType.QGAME)return PlatformProxy$3._createInstance("xiaomi");if(egret.Capabilities.runtimeType===egret.RuntimeType.FASTGAME)return PlatformProxy$3._createInstance("huawei");var a=PlatformProxy.createInstance();return a._sysCallback=function(){return{system:egret.Capabilities.os.replace(/\s*/g,""),mp_platform:egret.Capabilities.runtimeType}},a.request=function(t){var n={},e="GET"===t.method?egret.HttpMethod.GET:egret.HttpMethod.POST,i=new egret.HttpRequest;if(i.timeout=1e4,i.responseType=egret.HttpResponseType.TEXT,i.open(t.url,e),t.header)for(var r in t.header)i.setRequestHeader(r,t.header[r]);return i.send(t.data),i.addEventListener(egret.Event.COMPLETE,function(e){n.statusCode=200;e=e.currentTarget.response;_.isJSONString(e)&&(n.data=JSON.parse(e)),t.success(n)},a),i.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){n.errMsg="network error",t.fail(n)},a),i},a}}]),e}(),PlatformAPI=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"_getCurrentPlatform",value:function(){return this.currentPlatform||(this.currentPlatform=PlatformProxyEgret.createInstance())}},{key:"getConfig",value:function(){return this._getCurrentPlatform().getConfig()}},{key:"getStorage",value:function(e,t,n){return this._getCurrentPlatform().getStorage(e,t,n)}},{key:"setStorage",value:function(e,t){return this._getCurrentPlatform().setStorage(e,t)}},{key:"getSystemInfo",value:function(e){return this._getCurrentPlatform().getSystemInfo(e)}},{key:"getNetworkType",value:function(e){return this._getCurrentPlatform().getNetworkType(e)}},{key:"onNetworkStatusChange",value:function(e){this._getCurrentPlatform().onNetworkStatusChange(e)}},{key:"request",value:function(e){return this._getCurrentPlatform().request(e)}},{key:"initAutoTrackInstance",value:function(e,t){return this._getCurrentPlatform().initAutoTrackInstance(e,t)}},{key:"setGlobal",value:function(e,t){e&&t&&this._getCurrentPlatform().setGlobal(e,t)}},{key:"getAppOptions",value:function(e){return this._getCurrentPlatform().getAppOptions(e)}},{key:"showDebugToast",value:function(e){this._getCurrentPlatform().showToast(e)}}]),e}(),KEY_NAME_MATCH_REGEX=/^[a-zA-Z][a-zA-Z0-9_]{0,49}$/,PropertyChecker=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"stripProperties",value:function(e){return _.isObject(e)&&_.each(e,function(e,t){_.isString(e)||_.isNumber(e)||_.isDate(e)||_.isBoolean(e)||_.isArray(e)||_.isObject(e)||logger$1.warn("您的数据-",t,e,"-格式不满足要求，可能无法正确入库. 属性值只支持 String, Number, Date, Boolean, Array, Object")}),e}},{key:"_checkPropertiesKey",value:function(e){var n=!0;return _.each(e,function(e,t){KEY_NAME_MATCH_REGEX.test(t)||(logger$1.warn("不合法的 KEY 值: "+t),n=!1)}),n}},{key:"event",value:function(e){return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger$1.warn("请检查参数格式, eventName 必须是英文字母开头, 包含字母和数字和下划线的不超过50个字符的字符串: "+e),!1)}},{key:"propertyName",value:function(e){return!(!_.isString(e)||!KEY_NAME_MATCH_REGEX.test(e))||(logger$1.warn("请检查参数格式, propertyName 必须是英文字母开头, 包含字母和数字和下划线的不超过50个字符的字符串: "+e),!1)}},{key:"properties",value:function(e){return this.stripProperties(e),!e||(_.isObject(e)?!!this._checkPropertiesKey(e)||(logger$1.warn("请检查参数格式, properties 的 key 只能以字母开头，包含数字、字母和下划线 _，长度最大为50个字符"),!1):(logger$1.warn("properties 可以没有，但有的话必须是对象"),!1))}},{key:"propertiesMust",value:function(e){return this.stripProperties(e),void 0===e||!_.isObject(e)||_.isEmptyObject(e)?(logger$1.warn("properties必须是对象且有值"),!1):!!this._checkPropertiesKey(e)||(logger$1.warn("请检查参数格式, properties 的 key 只能以字母开头，包含数字、字母和下划线 _，长度最大为50个字符"),!1)}},{key:"userId",value:function(e){return!(!_.isString(e)||!/^.{1,64}$/.test(e))||(logger$1.warn("用户 id 必须是不能为空，且小于 64 位的字符串"),!1)}},{key:"userAddProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isNumber(e[t]))return logger$1.warn("userAdd 的属性需要为数值类型"),!1;return!0}},{key:"userAppendProperties",value:function(e){if(!this.propertiesMust(e))return!1;for(var t in e)if(!_.isArray(e[t]))return logger$1.warn("userAppend 的属性需要为 Array 类型"),!1;return!0}}]),e}(),HttpTask=function(){function a(e,t,n,i,r){_classCallCheck(this,a),this.data=e,this.serverUrl=t,this.callback=r,this.tryCount=_.isNumber(n)?n:1,this.timeout=_.isNumber(i)?i:3e3,this.taClassName="HttpTask"}return _createClass(a,[{key:"run",value:function(){var t=this,e=_.createExtraHeaders();e["content-type"]="application/json";var n=PlatformAPI.request({url:this.serverUrl,method:"POST",data:this.data,header:e,success:function(e){t.onSuccess(e)},fail:function(e){t.onFailed(e)}});setTimeout(function(){(_.isObject(n)||_.isPromise(n))&&_.isFunction(n.abort)&&n.abort()},this.timeout)}},{key:"onSuccess",value:function(e){if(200===e.statusCode){var t;switch(e.data.code){case 0:t="success";break;case-1:t="invalid data";break;case-2:t="invalid APP ID";break;default:t="Unknown return code"}this.callback({code:e.data.code,msg:t})}else this.callback({code:-3,msg:e.statusCode})}},{key:"onFailed",value:function(e){0<--this.tryCount?this.run():this.callback({code:-3,msg:e.errMsg})}}]),a}(),HttpTaskDebug=function(){function o(e,t,n,i,r,a,s){_classCallCheck(this,o),this.data=e,this.serverDebugUrl=t,this.callback=s,this.tryCount=_.isNumber(n)?n:1,this.timeout=_.isNumber(i)?i:3e3,this.dryrun=r,this.deviceId=a,this.taClassName="HttpTaskDebug"}return _createClass(o,[{key:"run",value:function(){var t=this,e="appid="+this.data["#app_id"]+"&source=client&dryRun="+this.dryrun+"&deviceId="+this.deviceId+"&data="+encodeURIComponent(JSON.stringify(this.data.data[0])),n=_.createExtraHeaders();n["content-type"]="application/x-www-form-urlencoded";var i=PlatformAPI.request({url:this.serverDebugUrl,method:"POST",data:e,header:n,success:function(e){t.onSuccess(e)},fail:function(e){t.onFailed(e)}});setTimeout(function(){(_.isObject(i)||_.isPromise(i))&&_.isFunction(i.abort)&&i.abort()},this.timeout)}},{key:"onSuccess",value:function(e){if(200===e.statusCode){var t;if(0===e.data.errorLevel)t="Verify data success.";else if(1===e.data.errorLevel){for(var n=e.data.errorProperties,i="",r=0;r<n.length;r++)var a=n[r].errorReason,i=i+" propertyName:"+n[r].propertyName+" errorReasons:"+a+"\n";t="Debug data error. errorLevel:"+e.data.errorLevel+" reason:"+i}else 2!==e.data.errorLevel&&-1!==e.data.errorLevel||(t="Debug data error. errorLevel:"+e.data.errorLevel+" reason:"+e.data.errorReasons);logger$1.info(t),this.callback({code:e.data.errorLevel,msg:t})}else this.callback({code:-3,msg:e.statusCode})}},{key:"onFailed",value:function(e){0<--this.tryCount?this.run():this.callback({code:-3,msg:e.errMsg})}}]),o}(),SenderQueue=function(){function e(){_classCallCheck(this,e),this.items=[],this.isRunning=!1,this.showDebug=!1}return _createClass(e,[{key:"enqueue",value:function(e,t,n,i){var i=!(3<arguments.length&&void 0!==i)||i,r=this,t="debug"===n.debugMode?new HttpTaskDebug(e,t,n.maxRetries,n.sendTimeout,0,n.deviceId,function(e){r.isRunning=!1,_.isFunction(n.callback)&&n.callback(e),r._runNext(),!1===r.showDebug&&(0!==e.code&&1!==e.code&&2!==e.code||(r.showDebug=!0,_.isFunction(PlatformAPI.showDebugToast)&&PlatformAPI.showDebugToast("当前为 debug 模式")))}):"debugOnly"===n.debugMode?new HttpTaskDebug(e,t,n.maxRetries,n.sendTimeout,1,n.deviceId,function(e){r.isRunning=!1,_.isFunction(n.callback)&&n.callback(e),r._runNext(),!1===r.showDebug&&(0!==e.code&&1!==e.code&&2!==e.code||(r.showDebug=!0,_.isFunction(PlatformAPI.showDebugToast)&&PlatformAPI.showDebugToast("当前为 debugOnly 模式")))}):new HttpTask(JSON.stringify(e),t,n.maxRetries,n.sendTimeout,function(e){r.isRunning=!1,_.isFunction(n.callback)&&n.callback(e),r._runNext()});1==i?(this.items.push(t),this._runNext()):t.run()}},{key:"_dequeue",value:function(){return this.items.shift()}},{key:"_runNext",value:function(){if(0<this.items.length&&!this.isRunning)if(this.isRunning=!0,"HttpTask"!=this.items[0].taClassName)this._dequeue().run();else{for(var e=this.items.splice(0,this.items.length),t=e[0],n=JSON.parse(t.data),i=n["#app_id"],r=1;r<e.length;r++){var a=e[r],s=JSON.parse(a.data);s["#app_id"]==i&&t.serverUrl==a.serverUrl?n.data=n.data.concat(s.data):this.items.push(a)}var o=(new Date).getTime();n["#flush_time"]=o,new HttpTask(JSON.stringify(n),t.serverUrl,t.tryCount,t.timeout,t.callback).run()}}}]),e}(),senderQueue=new SenderQueue,DEFAULT_CONFIG={name:"thinkingdata",is_plugin:!1,maxRetries:3,sendTimeout:3e3,enablePersistence:!0,asyncPersistence:!1,enableLog:!0,strict:!1,debugMode:"none"},systemInformation={properties:{"#lib":Config.LIB_NAME,"#lib_version":Config.LIB_VERSION},initDeviceId:function(e){_.isString(e)&&(this.properties["#device_id"]=e)},getSystemInfo:function(e){var n=this;PlatformAPI.onNetworkStatusChange(function(e){n.properties["#network_type"]=e.networkType}),PlatformAPI.getNetworkType({success:function(e){n.properties["#network_type"]=e.networkType},complete:function(){PlatformAPI.getSystemInfo({success:function(e){logger$1.info(JSON.stringify(e,null,4));var t=e.system?e.system.replace(/\s+/g," ").split(" "):[],t={"#manufacturer":e.brand,"#device_model":e.model,"#screen_width":Number(e.screenWidth),"#screen_height":Number(e.screenHeight),"#os":t[0],"#os_version":t[1],"#mp_platform":e.mp_platform};_.extend(n.properties,t),_.setMpPlatform(e.mp_platform)},complete:function(){e()}})}})}},ThinkingDataPersistence=function(){function e(t,n){var i=this;_classCallCheck(this,e),this.enabled=t.enablePersistence,this.enabled?(t.isChildInstance?(this.name=t.persistenceName+"_"+t.name,this.nameOld=t.persistenceNameOld+"_"+t.name):(this.name=t.persistenceName,this.nameOld=t.persistenceNameOld),t.asyncPersistence?(this._state={},PlatformAPI.getStorage(this.name,!0,function(e){_.isEmptyObject(e)?PlatformAPI.getStorage(i.nameOld,!0,function(e){i._state=_.extend2Layers({},e,i._state),i._init(t,n),i._save()}):(i._state=_.extend2Layers({},e,i._state),i._init(t,n),i._save())})):(this._state=PlatformAPI.getStorage(this.name)||{},_.isEmptyObject(this._state)&&(this._state=PlatformAPI.getStorage(this.nameOld)||{}),this._init(t,n))):(this._state={},this._init(t,n))}return _createClass(e,[{key:"_init",value:function(e,t){this.getDistinctId()||this.setDistinctId(_.UUID()),e.isChildInstance||(this.getDeviceId()||this._setDeviceId(_.UUID()),systemInformation.initDeviceId(this.getDeviceId())),this.initComplete=!0,"function"==typeof t&&t(),this._save()}},{key:"_save",value:function(){this.enabled&&this.initComplete&&PlatformAPI.setStorage(this.name,JSON.stringify(this._state))}},{key:"_set",value:function(e,t){var n,i=this;"string"==typeof e?(n={})[e]=t:"object"===_typeof(e)&&(n=e),_.each(n,function(e,t){i._state[t]=e}),this._save()}},{key:"_get",value:function(e){return this._state[e]}},{key:"setEventTimer",value:function(e,t){var n=this._state.event_timers||{};n[e]=t,this._set("event_timers",n)}},{key:"removeEventTimer",value:function(e){var t=(this._state.event_timers||{})[e];return _.isUndefined(t)||(delete this._state.event_timers[e],this._save()),t}},{key:"getDeviceId",value:function(){return this._state.device_id}},{key:"_setDeviceId",value:function(e){this.getDeviceId()?logger$1.warn("cannot modify the device id."):this._set("device_id",e)}},{key:"getDistinctId",value:function(){return this._state.distinct_id}},{key:"setDistinctId",value:function(e){this._set("distinct_id",e)}},{key:"getAccountId",value:function(){return this._state.account_id}},{key:"setAccountId",value:function(e){this._set("account_id",e)}},{key:"getSuperProperties",value:function(){return this._state.props||{}}},{key:"setSuperProperties",value:function(e,t){e=t?e:_.extend(this.getSuperProperties(),e);this._set("props",e)}}]),e}(),ThinkingDataAPI=function(){function n(e){_classCallCheck(this,n),e.appId=e.appId?_.checkAppId(e.appId):_.checkAppId(e.appid),e.serverUrl=e.serverUrl?_.checkUrl(e.serverUrl):_.checkUrl(e.server_url);var t=_.extend({},DEFAULT_CONFIG,PlatformAPI.getConfig());_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)}return _createClass(n,[{key:"_init",value:function(e){var t=this;this.name=e.name,this.appId=e.appId||e.appid;var n=e.serverUrl||e.server_url;this.serverUrl=n+"/sync_xcx",this.serverDebugUrl=n+"/data_debug",this.configUrl=n+"/config",this.autoTrackProperties={},this._queue=[],this.updateConfig(this.configUrl,this.appId),e.isChildInstance?this._state={}:(logger$1.enabled=e.enableLog,this.instances=[],this._state={getSystemInfo:!1,initComplete:!1},systemInformation.getSystemInfo(function(){t._updateState({getSystemInfo:!0})}),PlatformAPI.setGlobal(this,this.name)),this.store=new ThinkingDataPersistence(e,function(){t.config.asyncPersistence&&_.isFunction(t.config.persistenceComplete)&&t.config.persistenceComplete(t),t._updateState()}),this.enabled=!_.isBoolean(this.store._get("ta_enabled"))||this.store._get("ta_enabled"),this.isOptOut=!!_.isBoolean(this.store._get("ta_isOptOut"))&&this.store._get("ta_isOptOut"),!e.isChildInstance&&e.autoTrack&&(this.autoTrack=PlatformAPI.initAutoTrackInstance(this,e))}},{key:"updateConfig",value:function(e,t){var n=this,i=_.createExtraHeaders();i["content-type"]="application/json";var r=PlatformAPI.request({url:e+"?appid="+t,method:"GET",header:i,success:function(e){logger$1.info("config update success("+t+") :"+JSON.stringify(e.data)),n.config.syncBatchSize=e.data.data.sync_batch_size,n.config.syncInterval=e.data.data.sync_interval,n.config.disableEventList=e.data.data.disable_event_list},fail:function(e){logger$1.info("config update fail("+t+") :"+e.errMsg)}});setTimeout(function(){(_.isObject(r)||_.isPromise(r))&&_.isFunction(r.abort)&&r.abort()},3e3)}},{key:"initInstance",value:function(e,t){if(this.config.isChildInstance)logger$1.warn("initInstance() cannot be called on child instance");else{if(_.isString(e)&&e!==this.name&&_.isUndefined(this[e])){t=new n(_.extend({},this.config,{enablePersistence:!1,isChildInstance:!0,name:e},t));return this[e]=t,this.instances.push(e),this[e]._state=this._state,t}logger$1.warn("initInstance() failed due to the name is invalid: "+e)}}},{key:"lightInstance",value:function(e){return this[e]}},{key:"_setAutoTrackProperties",value:function(e){_.extend(this.autoTrackProperties,e)}},{key:"init",value:function(){if(this._state.initComplete)return!1;this._updateState({initComplete:!0})}},{key:"_isReady",value:function(){return this._state.getSystemInfo&&this._state.initComplete&&this.store.initComplete&&this.getDeviceId()}},{key:"_updateState",value:function(e){var t=this;_.isObject(e)&&_.extend(this._state,e),this._onStateChange(),_.each(this.instances,function(e){t[e]._onStateChange()})}},{key:"_onStateChange",value:function(){var t=this;this._isReady()&&this._queue&&0<this._queue.length&&(_.each(this._queue,function(e){t[e[0]].apply(t,slice.call(e[1]))}),this._queue=[])}},{key:"_hasDisabled",value:function(){var e=!this.enabled||this.isOptOut;return e&&logger$1.info("ThinkingData is Pause or Stop!"),e}},{key:"_sendRequest",value:function(e,t){var n,i;this._hasDisabled()||(null!=this.config.disableEventList&&this.config.disableEventList.includes(e.eventName)?logger$1.info("disabled Event : "+e.eventName):(t=_.isDate(t)?t:new Date,n={data:[{"#type":e.type,"#time":_.formatDate(t),"#distinct_id":this.store.getDistinctId()}]},this.store.getAccountId()&&(n.data[0]["#account_id"]=this.store.getAccountId()),"track"===e.type||"track_update"===e.type||"track_overwrite"===e.type?(n.data[0]["#event_name"]=e.eventName,"track_update"===e.type||"track_overwrite"===e.type?n.data[0]["#event_id"]=e.extraId:e.firstCheckId&&(n.data[0]["#first_check_id"]=e.firstCheckId),n.data[0].properties=_.extend({"#zone_offset":0-t.getTimezoneOffset()/60},systemInformation.properties,this.autoTrackProperties,this.store.getSuperProperties(),this.dynamicProperties?this.dynamicProperties():{}),t=this.store.removeEventTimer(e.eventName),_.isUndefined(t)||(i=(new Date).getTime()-t,n.data[0].properties["#duration"]=parseFloat((i/1e3).toFixed(3)))):n.data[0].properties={},_.isObject(e.properties)&&!_.isEmptyObject(e.properties)&&_.extend(n.data[0].properties,e.properties),_.searchObjDate(n.data[0]),1<this.config.maxRetries&&(n.data[0]["#uuid"]=_.UUIDv4()),n["#app_id"]=this.appId,logger$1.info(JSON.stringify(n,null,4)),i="debug"===this.config.debugMode||"debugOnly"===this.config.debugMode?this.serverDebugUrl:this.serverUrl,senderQueue.enqueue(n,i,{maxRetries:this.config.maxRetries,sendTimeout:this.config.sendTimeout,callback:e.onComplete,debugMode:this.config.debugMode,deviceId:this.getDeviceId()})))}},{key:"_isObjectParams",value:function(e){return _.isObject(e)&&_.isFunction(e.onComplete)}},{key:"track",value:function(e,t,n,i){var r;this._hasDisabled()||(this._isObjectParams(e)&&(e=(r=e).eventName,t=r.properties,n=r.time,i=r.onComplete),PropertyChecker.event(e)&&PropertyChecker.properties(t)||!this.config.strict?this._internalTrack(e,t,n,i):_.isFunction(i)&&i({code:-1,msg:"invalid parameters"}))}},{key:"trackUpdate",value:function(e){var t;this._hasDisabled()||(e&&e.eventId&&(PropertyChecker.event(e.eventName)&&PropertyChecker.properties(e.properties)||!this.config.strict)?(t=_.isDate(e.time)?e.time:new Date,this._isReady()?this._sendRequest({type:"track_update",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,extraId:e.eventId},t):(e.time=t,this._queue.push(["trackUpdate",[e]]))):(logger$1.warn("Invalide parameter for trackUpdate: you should pass an object contains eventId to trackUpdate()"),_.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})))}},{key:"trackOverwrite",value:function(e){var t;this._hasDisabled()||(e&&e.eventId&&(PropertyChecker.event(e.eventName)&&PropertyChecker.properties(e.properties)||!this.config.strict)?(t=_.isDate(e.time)?e.time:new Date,this._isReady()?this._sendRequest({type:"track_overwrite",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,extraId:e.eventId},t):(e.time=t,this._queue.push(["trackOverwrite",[e]]))):(logger$1.warn("Invalide parameter for trackOverwrite: you should pass an object contains eventId to trackOverwrite()"),_.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})))}},{key:"trackFirstEvent",value:function(e){var t;this._hasDisabled()||(e&&e.eventName&&(PropertyChecker.event(e.eventName)&&PropertyChecker.properties(e.properties)||!this.config.strict)?(t=_.isDate(e.time)?e.time:new Date,this._isReady()?this._sendRequest({type:"track",eventName:e.eventName,properties:e.properties,onComplete:e.onComplete,firstCheckId:e.firstCheckId||this.getDeviceId()},t):(e.time=t,this._queue.push(["trackFirstEvent",[e]]))):(logger$1.warn("Invalide parameter for trackFirstEvent: you should pass an object contains eventName to trackFirstEvent()"),_.isFunction(e.onComplete)&&e.onComplete({code:-1,msg:"invalid parameters"})))}},{key:"_internalTrack",value:function(e,t,n,i){this._hasDisabled()||(n=_.isDate(n)?n:new Date,this._isReady()?this._sendRequest({type:"track",eventName:e,properties:t,onComplete:i},n):this._queue.push(["_internalTrack",[e,t,n,i]]))}},{key:"userSet",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_set",properties:e,onComplete:n},t):this._queue.push(["userSet",[e,t,n]])):(logger$1.warn("calling userSet failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userSetOnce",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.propertiesMust(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_setOnce",properties:e,onComplete:n},t):this._queue.push(["userSetOnce",[e,t,n]])):(logger$1.warn("calling userSetOnce failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userUnset",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(i)&&(e=i.property,t=i.time,n=i.onComplete),PropertyChecker.propertyName(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?((i={})[e]=0,this._sendRequest({type:"user_unset",properties:i,onComplete:n},t)):this._queue.push(["userUnset",[e,n,t]])):(logger$1.warn("calling userUnset failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userDel",value:function(e,t){var n;this._hasDisabled()||(this._isObjectParams(e)&&(e=(n=e).time,t=n.onComplete),e=_.isDate(e)?e:new Date,this._isReady()?this._sendRequest({type:"user_del",onComplete:t},e):this._queue.push(["userDel",[e,t]]))}},{key:"userAdd",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.userAddProperties(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_add",properties:e,onComplete:n},t):this._queue.push(["userAdd",[e,t,n]])):(logger$1.warn("calling userAdd failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"userAppend",value:function(e,t,n){var i;this._hasDisabled()||(this._isObjectParams(e)&&(e=(i=e).properties,t=i.time,n=i.onComplete),PropertyChecker.userAppendProperties(e)||!this.config.strict?(t=_.isDate(t)?t:new Date,this._isReady()?this._sendRequest({type:"user_append",properties:e,onComplete:n},t):this._queue.push(["userAppend",[e,t,n]])):(logger$1.warn("calling userAppend failed due to invalid arguments"),_.isFunction(n)&&n({code:-1,msg:"invalid parameters"})))}},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setDistinctId(e)}}},{key:"getDistinctId",value:function(){return this.store.getDistinctId()}},{key:"login",value:function(e){if(!this._hasDisabled()){if("number"==typeof e)e=String(e);else if("string"!=typeof e)return!1;this.store.setAccountId(e)}}},{key:"getAccountId",value:function(){return this.store.getAccountId()}},{key:"logout",value:function(){this._hasDisabled()||this.store.setAccountId(null)}},{key:"setSuperProperties",value:function(e){this._hasDisabled()||(PropertyChecker.propertiesMust(e)||!this.config.strict?this.store.setSuperProperties(e):logger$1.warn("setSuperProperties 的参数必须是合法的属性值"))}},{key:"clearSuperProperties",value:function(){this._hasDisabled()||this.store.setSuperProperties({},!0)}},{key:"unsetSuperProperty",value:function(e){var t;this._hasDisabled()||_.isString(e)&&(delete(t=this.getSuperProperties())[e],this.store.setSuperProperties(t,!0))}},{key:"getSuperProperties",value:function(){return this.store.getSuperProperties()}},{key:"getPresetProperties",value:function(){var e=systemInformation.properties,t={},n=e["#os"];t.os=_.isUndefined(n)?"":n;n=e["#screen_width"];t.screenWidth=_.isUndefined(n)?0:n;n=e["#screen_height"];t.screenHeight=_.isUndefined(n)?0:n;n=e["#network_type"];t.networkType=_.isUndefined(n)?"":n;n=e["#device_model"];t.deviceModel=_.isUndefined(n)?"":n;n=e["#os_version"];t.osVersion=_.isUndefined(n)?"":n,t.deviceId=this.getDeviceId();var i=0-(new Date).getTimezoneOffset()/60;t.zoneOffset=i;e=e["#manufacturer"];return t.manufacturer=_.isUndefined(e)?"":e,t.toEventPresetProperties=function(){return{"#device_model":t.deviceModel,"#device_id":t.deviceId,"#screen_width":t.screenWidth,"#screen_height":t.screenHeight,"#os":t.os,"#os_version":t.osVersion,"#network_type":t.networkType,"#zone_offset":i,"#manufacturer":t.manufacturer}},t}},{key:"setDynamicSuperProperties",value:function(e){this._hasDisabled()||("function"==typeof e?PropertyChecker.properties(e())||!this.config.strict?this.dynamicProperties=e:logger$1.warn("动态公共属性必须返回合法的属性值"):logger$1.warn("setDynamicSuperProperties 的参数必须是 function 类型"))}},{key:"timeEvent",value:function(e,t){this._hasDisabled()||(t=_.isDate(t)?t:new Date,this._isReady()?PropertyChecker.event(e)||!this.config.strict?this.store.setEventTimer(e,t.getTime()):logger$1.warn("calling timeEvent failed due to invalid eventName: "+e):this._queue.push(["timeEvent",[e,t]]))}},{key:"getDeviceId",value:function(){return systemInformation.properties["#device_id"]}},{key:"enableTracking",value:function(e){this.enabled=e,this.store._set("ta_enabled",e)}},{key:"optOutTracking",value:function(){this.clearSuperProperties(),this.store.setDistinctId(_.UUID()),this.store.setAccountId(null),this._queue.splice(0,this._queue.length),this.isOptOut=!0,this.store._set("ta_isOptOut",!0)}},{key:"optOutTrackingAndDeleteUser",value:function(){var e=new Date;this._sendRequest({type:"user_del"},e),this.optOutTracking()}},{key:"optInTracking",value:function(){this.isOptOut=!1,this.store._set("ta_isOptOut",!1)}}]),n}(),DEFAULT_CONFIG$1={name:"thinkingdata",is_plugin:!1,maxRetries:3,sendTimeout:3e3,enablePersistence:!0,asyncPersistence:!1,enableLog:!0,strict:!1,debugMode:"none",enableNative:!1},ThinkingDataAPIForNative=function(){function n(e){_classCallCheck(this,n),e.appId=e.appId?_.checkAppId(e.appId):_.checkAppId(e.appid),e.serverUrl=e.serverUrl?_.checkUrl(e.serverUrl):_.checkUrl(e.server_url);var t=_.extend({},DEFAULT_CONFIG$1);_.isObject(e)?this.config=_.extend(t,e):this.config=t,this._init(this.config)}return _createClass(n,[{key:"_isNativePlatform",value:function(){return!(!this._isIOS()&&!this._isAndroid()||!this.config.enableNative)}},{key:"_isIOS",value:function(){return"iOS"===egret.Capabilities.os&&egret.Capabilities.runtimeType==egret.RuntimeType.RUNTIME2}},{key:"_isAndroid",value:function(){return"Android"===egret.Capabilities.os&&egret.Capabilities.runtimeType==egret.RuntimeType.RUNTIME2}},{key:"_init",value:function(e){this.name=e.name,this.appId=e.appId||e.appid,this._isNativePlatform()?(this.initInstance_native(this.name,e,this.appId),this._readStorage(e)):this.taJs=new ThinkingAnalyticsAPIForJS(e)}},{key:"_readStorage",value:function(e){var t=this,n=e.persistenceName,i=e.persistenceNameOld;e.isChildInstance&&(n=e.persistenceName+"_"+e.name,i=e.persistenceNameOld+"_"+e.name),e.asyncPersistence?(this._state={},PlatformAPI.getStorage(n,!0,function(e){_.isEmptyObject(e)?PlatformAPI.getStorage(i,!0,function(e){t._state=_.extend2Layers({},e,t._state)}):t._state=_.extend2Layers({},e,t._state)})):(this._state=PlatformAPI.getStorage(n)||{},_.isEmptyObject(this._state)&&(this._state=PlatformAPI.getStorage(i)||{})),this._state.distinct_id&&this.identify_native(this._state.distinct_id),this._state.account_id&&this.login_native(this._state.account_id)}},{key:"initInstance",value:function(e,t){return this._isNativePlatform()?this[e]=null!=t?new ThinkingAnalyticsAPI(t):new ThinkingAnalyticsAPI(this.config):this[e]=this.taJs.initInstance(e,t),this[e]}},{key:"lightInstance",value:function(e){return this[e]}},{key:"init",value:function(){this._isNativePlatform()?this.startThinkingAnalytics_native():this.taJs.init()}},{key:"track",value:function(e,t,n,i){this._isNativePlatform()?this.track_native(e,t,n,this.appId):this.taJs.track(e,t,n,i)}},{key:"trackUpdate",value:function(e){this._isNativePlatform()?this.trackUpdate_native(e,this.appId):this.taJs.trackUpdate(e)}},{key:"trackOverwrite",value:function(e){this._isNativePlatform()?this.trackOverwrite_native(e,this.appId):this.taJs.trackOverwrite(e)}},{key:"trackFirstEvent",value:function(e){this._isNativePlatform()?this.trackFirstEvent_native(e,this.appId):this.taJs.trackFirstEvent(e)}},{key:"userSet",value:function(e,t,n){this._isNativePlatform()?this.userSet_native(e,this.appId):this.taJs.userSet(e,t,n)}},{key:"userSetOnce",value:function(e,t,n){this._isNativePlatform()?this.userSetOnce_native(e,this.appId):this.taJs.userSetOnce(e,t,n)}},{key:"userUnset",value:function(e,t,n){this._isNativePlatform()?this.userUnset_native(e,this.appId):this.taJs.userUnset(e,t,n)}},{key:"userDel",value:function(e,t){this._isNativePlatform()?this.userDel_native(this.appId):this.taJs.userDel(e,t)}},{key:"userAdd",value:function(e,t,n){this._isNativePlatform()?this.userAdd_native(e,this.appId):this.taJs.userAdd(e,t,n)}},{key:"userAppend",value:function(e,t,n){this._isNativePlatform()?this.userAppend_native(e,this.appId):this.taJs.userAppend(e,t,n)}},{key:"authorizeOpenID",value:function(e){this.identify(e)}},{key:"identify",value:function(e){this._isNativePlatform()?this.identify_native(e,this.appId):this.taJs.identify(e)}},{key:"getDistinctId",value:function(e){if(null!=e){if(this._isNativePlatform())return void this.getDistinctId_native(e,this.appId);e(this.taJs.getDistinctId())}return this.taJs.getDistinctId()}},{key:"login",value:function(e){this._isNativePlatform()?this.login_native(e,this.appId):this.taJs.login(e)}},{key:"getAccountId",value:function(e){if(null!=e){if(this._isNativePlatform())return void this.getAccountId_native(e,this.appId);e(this.taJs.getAccountId())}return this.taJs.getAccountId()}},{key:"logout",value:function(){this._isNativePlatform()?this.logout_native(this.appId):this.taJs.logout()}},{key:"setSuperProperties",value:function(e){this._isNativePlatform()?this.setSuperProperties_native(e,this.appId):this.taJs.setSuperProperties(e)}},{key:"clearSuperProperties",value:function(){this._isNativePlatform()?this.clearSuperProperties_native(this.appId):this.taJs.clearSuperProperties()}},{key:"unsetSuperProperty",value:function(e){this._isNativePlatform()?this.unsetSuperProperty_native(e,this.appId):this.taJs.unsetSuperProperty(e)}},{key:"getSuperProperties",value:function(e){if(null!=e){if(this._isNativePlatform())return void this.getSuperProperties_native(e,this.appId);e(this.taJs.getSuperProperties())}return this.taJs.getSuperProperties()}},{key:"getPresetProperties",value:function(e){if(null!=e){if(this._isNativePlatform())return void this.getPresetProperties_native(e,this.appId);e(this.taJs.getPresetProperties())}return this.taJs.getPresetProperties()}},{key:"setDynamicSuperProperties",value:function(e){this._isNativePlatform()?"function"==typeof e?this.dynamicProperties=e:logger.warn("setDynamicSuperProperties 的参数必须是 function 类型"):this.taJs.setDynamicSuperProperties(e)}},{key:"timeEvent",value:function(e,t){return this._isNativePlatform()?this.timeEvent_native(e,this.appId):this.taJs.timeEvent(e,t)}},{key:"getDeviceId",value:function(e){if(null!=e){if(this._isNativePlatform())return void this.getDeviceId_native(e,this.appId);e(this.taJs.getDeviceId())}return this.taJs.getDeviceId()}},{key:"enableTracking",value:function(e){this._isNativePlatform()?this.enableTracking_native(e,this.appId):this.taJs.enableTracking(e)}},{key:"optOutTracking",value:function(){this._isNativePlatform()?this.optOutTracking_native(this.appId):this.taJs.optOutTracking()}},{key:"optOutTrackingAndDeleteUser",value:function(){this._isNativePlatform()?this.optOutTrackingAndDeleteUser_native(this.appId):this.taJs.optOutTrackingAndDeleteUser()}},{key:"optInTracking",value:function(){this._isNativePlatform()?this.optInTracking_native(this.appId):this.taJs.optInTracking()}},{key:"formatDate",value:function(e){return null==e?null:e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())+"."+(e.getMilliseconds()<10?"00"+e.getMilliseconds():e.getMilliseconds()<100?"0"+e.getMilliseconds():e.getMilliseconds())}},{key:"track_native",value:function(e,t,n,i){n=this.formatDate(n);e=null!=e?e:"",t=null!=t?t:{},n=null!=n?n:"",i=null!=i?i:"";t=_.extend(t,this.dynamicProperties?this.dynamicProperties():{}),i={eventName:e,properties:JSON.stringify(t),formatTime:n,appId:i},i=JSON.stringify(i);egret.ExternalInterface.call("track",i)}},{key:"trackUpdate_native",value:function(e,t){t=null!=t?t:"",(e=null!=e?e:{}).properties=_.extend(null!=e.properties?e.properties:{},this.dynamicProperties?this.dynamicProperties():{});t={taEvent:JSON.stringify(e),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("trackUpdate",t)}},{key:"trackFirstEvent_native",value:function(e,t){t=null!=t?t:"",(e=null!=e?e:{}).properties=_.extend(null!=e.properties?e.properties:{},this.dynamicProperties?this.dynamicProperties():{});t={taEvent:JSON.stringify(e),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("trackFirstEvent",t)}},{key:"trackOverwrite_native",value:function(e,t){t=null!=t?t:"",(e=null!=e?e:{}).properties=_.extend(null!=e.properties?e.properties:{},this.dynamicProperties?this.dynamicProperties():{});t={taEvent:JSON.stringify(e),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("trackOverwrite",t)}},{key:"timeEvent_native",value:function(e,t){t={eventName:e=null!=e?e:"",appId:t=null!=t?t:""},t=JSON.stringify(t);egret.ExternalInterface.call("timeEvent",t)}},{key:"login_native",value:function(e,t){t={accoundId:e=null!=e?e:"",appId:t=null!=t?t:""},t=JSON.stringify(t);egret.ExternalInterface.call("login",t)}},{key:"logout_native",value:function(e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.call("logout",e)}},{key:"setSuperProperties_native",value:function(e,t){e=null!=e?e:{},t=null!=t?t:"";t={properties:JSON.stringify(e),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("setSuperProperties",t)}},{key:"getSuperProperties_native",value:function(t,e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.addCallback("getSuperProperties",function(e){t(JSON.parse(e))}),egret.ExternalInterface.call("getSuperProperties",e)}},{key:"unsetSuperProperty_native",value:function(e,t){t={property:e=null!=e?e:"",appId:t=null!=t?t:""},t=JSON.stringify(t);egret.ExternalInterface.call("unsetSuperProperty",t)}},{key:"clearSuperProperties_native",value:function(e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.call("clearSuperProperties",e)}},{key:"userSet_native",value:function(e,t){e=null!=e?e:{},t=null!=t?t:"";t={properties:JSON.stringify(e),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("userSet",t)}},{key:"userSetOnce_native",value:function(e,t){e=null!=e?e:{},t=null!=t?t:"";t={properties:JSON.stringify(e),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("userSetOnce",t)}},{key:"userAppend_native",value:function(e,t){e=null!=e?e:{},t=null!=t?t:"";t={properties:JSON.stringify(e),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("userAppend",t)}},{key:"userAdd_native",value:function(e,t){e=null!=e?e:{},t=null!=t?t:"";t={properties:JSON.stringify(e),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("userAdd",t)}},{key:"userUnset_native",value:function(e,t){t={property:e=null!=e?e:"",appId:t=null!=t?t:""},t=JSON.stringify(t);egret.ExternalInterface.call("userUnset",t)}},{key:"userDel_native",value:function(e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.call("userDel",e)}},{key:"authorizeOpenID_native",value:function(e,t){this.identify_native(e,t)}},{key:"identify_native",value:function(e,t){t={distinctId:e=null!=e?e:"",appId:t=null!=t?t:""},t=JSON.stringify(t);egret.ExternalInterface.call("identify",t)}},{key:"initInstance_native",value:function(e,t,n){e=null!=e?e:"",t=null!=t?t:{},n=null!=n?n:"",egret.ExternalInterface.call("setCustomerLibInfo",JSON.stringify({libName:Config.LIB_NAME,libVersion:Config.LIB_VERSION})),null!=t?(t={name:e,config:JSON.stringify(t)},t=JSON.stringify(t),egret.ExternalInterface.call("initInstanceConfig",t)):(n={name:e,appId:n},n=JSON.stringify(n),egret.ExternalInterface.call("initInstanceAppId",n))}},{key:"lightInstance_native",value:function(e,t,n){t={name:e=null!=e?e:"",appId:t=null!=t?t:""},t=JSON.stringify(t);egret.ExternalInterface.addCallback("lightInstance",function(e){n(e)}),egret.ExternalInterface.call("lightInstance",t)}},{key:"startThinkingAnalytics_native",value:function(e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.call("startThinkingAnalytics",e)}},{key:"setDynamicSuperProperties_native",value:function(e,t){t={dynamicProperties:e,appId:t=null!=t?t:""},t=JSON.stringify(t);egret.ExternalInterface.addCallback("setDynamicSuperProperties",function(e){}),egret.ExternalInterface.call("setDynamicSuperProperties",t)}},{key:"getDeviceId_native",value:function(t,e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.addCallback("getDeviceId",function(e){t(e)}),egret.ExternalInterface.call("getDeviceId",e)}},{key:"getDistinctId_native",value:function(t,e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.addCallback("getDistinctId",function(e){t(e)}),egret.ExternalInterface.call("getDistinctId",e)}},{key:"getAccountId_native",value:function(t,e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.addCallback("getAccountId",function(e){t(e)}),egret.ExternalInterface.call("getAccountId",e)}},{key:"getPresetProperties_native",value:function(i,e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.addCallback("getPresetProperties",function(e){var t=JSON.parse(e),n={},e=t["#os"];n.os=_.isUndefined(e)?"":e;e=t["#screen_width"];n.screenWidth=_.isUndefined(e)?0:e;e=t["#screen_height"];n.screenHeight=_.isUndefined(e)?0:e;e=t["#network_type"];n.networkType=_.isUndefined(e)?"":e;e=t["#device_model"];n.deviceModel=_.isUndefined(e)?"":e;e=t["#os_version"];n.osVersion=_.isUndefined(e)?"":e;e=t["#device_id"];n.deviceId=_.isUndefined(e)?"":e;e=t["#zone_offset"];n.zoneOffset=_.isUndefined(e)?"":e;t=t["#manufacturer"];n.manufacturer=_.isUndefined(t)?"":t,n.toEventPresetProperties=function(){return{"#device_model":n.deviceModel,"#device_id":n.deviceId,"#screen_width":n.screenWidth,"#screen_height":n.screenHeight,"#os":n.os,"#os_version":n.osVersion,"#network_type":n.networkType,"#zone_offset":n.zoneOffset,"#manufacturer":n.manufacturer}},i(n)}),egret.ExternalInterface.call("getPresetProperties",e)}},{key:"enableTracking_native",value:function(e,t){t=null!=t?t:"";t={enabled:(e=null!=e&&e).toString(),appId:t},t=JSON.stringify(t);egret.ExternalInterface.call("enableTracking",t)}},{key:"optOutTracking_native",value:function(e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.call("optOutTracking",e)}},{key:"optOutTrackingAndDeleteUser_native",value:function(e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.call("optOutTrackingAndDeleteUser",e)}},{key:"optInTracking_native",value:function(e){e={appId:e=null!=e?e:""},e=JSON.stringify(e);egret.ExternalInterface.call("optInTracking",e)}}]),n}();window.ThinkingAnalyticsAPI=ThinkingDataAPIForNative,window.ThinkingAnalyticsAPIForJS=ThinkingDataAPI;